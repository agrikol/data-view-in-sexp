# S‑expression Schema Language

Данный документ описывает язык описания схем для S‑выражений, используемый совместно с моделью `Node`, интерпретатором схем `Interpreter` и валидатором `Validator`.
---

## 1. Назначение

Язык схем предназначен для:

* описания структуры S‑выражения;
* проверки имён узлов;
* валидации типов скалярных значений;
* контроля атрибутов;
* ограничения количества дочерних элементов.

Схема интерпретируется в объектную модель `SchemaNode`, после чего применяется к документу `Node` валидатором.

---

## 2. Модель данных схемы (`SchemaNode`)

```python
@dataclass
class SchemaNode:
    name: str
    value_type: Literal["string", "number", "boolean", "null"] | None

    required: bool
    min_occurs: int
    max_occurs: int | "unbounded"

    attrs: dict[str, SchemaNode]
    children: list[SchemaNode]
```

### Семантика полей

* `name` — имя элемента (обязательно)
* `value_type` — тип скалярного значения элемента
* `required` — обязателен ли элемент (используется для дочерних элементов)
* `min_occurs` — минимальное число вхождений
* `max_occurs` — максимальное число вхождений или `unbounded`
* `attrs` — описание допустимых атрибутов
* `children` — описание допустимых дочерних элементов

---

## 3. Корневой узел схемы

Схема **обязана** иметь следующий вид:

```lisp
(schema (element ...))
```
или 

```lisp
(schema (:version "1.0") (element ...))
```

Ограничения:

* корневой узел должен называться `schema`
* допускается **только атрибут `version`**
* `schema` **не может иметь scalar‑значение**
* `schema` **должен содержать ровно один дочерний элемент `element`**

---

## 4. Описание элемента (`element`)

Каждый элемент схемы описывается узлом:

```lisp
(element (:name "book") ...)
```

### Обязательные требования

* имя узла должно быть `element`
* атрибут `name` обязателен
* `name` должен быть скаляром `Scalar`

---

## 5. Обязательность (`required`)

```lisp
(required true)
```

* принимает только `true` или `false`
* влияет на допустимые значения `min_occurs`

Ограничения:

* `required = true` несовместим с `min_occurs < 1`

---

## 6. Кратность элементов

### Минимальное число

```lisp
(min_occurs 0)
```

Ограничения:

* не может быть отрицательным
* если `required = true`, `min_occurs` ≥ 1

---

### Максимальное число

```lisp
(max_occurs "unbounded")
```

Допустимые значения:

* целое число
* строка `"unbounded"`

Ограничения:

* `max_occurs` не может быть меньше `min_occurs`

---

## 7. Атрибуты элемента

```lisp
(attrs
  (attr (:name "lang")
    (type "string")
    (required true)))
```

Правила:

* контейнер `attrs` может содержать только `attr`
* каждый `attr` обязан иметь атрибут `name`
* `attr` описывается через `SchemaNode`

Поддерживаются свойства:

* `type`
* `required`

---

## 8. Дочерние элементы

```lisp
(children
  (element (:name "title") ...)
  (element (:name "author") ...))
```

Правила:

* контейнер `children` содержит только `element`

---