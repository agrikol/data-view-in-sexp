# SPath — язык навигации по S-выражениям

SPath — это XPath‑подобный язык запросов для навигации и фильтрации деревьев, представленных в виде S‑выражений и модели `Node`.


## 1. Модель данных

Навигация выполняется по дереву узлов `Node`:

* `name: str` — имя узла
* `attrs: dict[str, Scalar]` — атрибуты узла
* `children: list[Node]` — дочерние узлы
* `scalar: Scalar | None` — скалярное значение (лист)


---

## 2. Грамматика SPath

- path    := (SLASH | DOUBLE_SLASH)? step ( (SLASH | DOUBLE_SLASH) step )*
- step    := DOT | IDENT filter*
- filter  := '[' (':'? IDENT) (EQ | NEQ) literal ']'
- literal := STRING | NUMBER | BOOLEAN | NULL
---

## 3. Шаги навигации (step)

### `.` — текущий узел

Возвращает текущий контекст без изменений.

```spath
.
```

---

### `IDENT` — дочерние узлы по имени

Выбирает **всех дочерних узлов** с данным именем.

```spath
book
```

---

## 4. Оси навигации

### Относительный путь

```spath
book/title
```

Навигация выполняется от текущего узла.

---

### `/` — корневой переход

```spath
/book
```

Переход к корню, затем выбор `book`.

---

### `//` — рекурсивный поиск

```spath
//tag
```

Ищет **все узлы ****`tag`**** на любой глубине**.

---

## 5. Фильтры

Фильтр **всегда применяется к текущему узлу**, а не к его детям.

Фильтр **либо оставляет узел**, либо **отбрасывает его целиком**.

---

### 5.1 Фильтр по дочерним узлам

```spath
book[title="Война и мир"]
```

Узел `book` проходит фильтр, если:

* существует **хотя бы один** дочерний узел `title`
* `title` — лист
* `title.scalar == "Война и мир"`

---

### 5.2 Фильтр по атрибутам

Используется префикс `:`

```spath
author[:born=1828]
```

---
